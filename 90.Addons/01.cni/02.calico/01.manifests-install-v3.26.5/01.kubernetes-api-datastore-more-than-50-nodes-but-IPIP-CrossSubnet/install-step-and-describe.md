# 1.Calico IPIP模式之CoressSubnet的相关说明
## 1.1 网络平面图
<image src="./picture/calico-ipip-coresssubnet-plan.jpg" style="width: 100%; height: auto;">

## 1.2 各宿主机上的路由
**Node网络下Subnet(172.31.0.0/24)下的节点(k8s node01)**
```
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.0.0        0.0.0.0         255.255.255.0   U     0      0        0 *
10.0.0.1        0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>  
10.0.0.2        0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
10.0.0.255      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>    # 本机上其Pod副本的路由

10.0.1.0        172.31.0.2      255.255.255.0   UG    0      0        0 eth0
10.0.2.0        172.31.0.3      255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
10.0.253.0      172.31.0.254    255.255.255.0   UG    0      0        0 eth0                # 非本宿主机上的eth0网卡，node01所在Node网络下相同Subnet下各node从Pod网络中所得subnet，相关路由

10.0.254.0      172.31.1.1      255.255.255.0   UG    0      0        0 tunl0
10.0.255.0      172.31.1.2      255.255.255.0   UG    0      0        0 tunl0
10.1.0.0        172.31.1.3      255.255.255.0   UG    0      0        0 tunl0
10.1.1.0        172.31.1.4      255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
10.1.251.0      172.31.1.254    255.255.255.0   UG    0      0        0 tunl0               # 非本宿主机上的tunl0网卡(隧道设备)，node01所在Node网络下不同Subnet下各node从Pod网络中所得subnet，相关路由

0.0.0.0         172.31.0.255    0.0.0.0         UG    0      0        0 eth0                # node01到所处Node网络下Subnet其网关的路由
172.31.0.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0                # node01到所处Node网络下Subnet其网关的路由
```

**Node网络下Subnet(172.31.0.0/24)下的节点(k8s node02)**
```
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.1.0        0.0.0.0         255.255.255.0   U     0      0        0 *
10.0.1.1        0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>  
10.0.1.2        0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
10.0.1.255      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>    # 本机上其Pod副本的路由

10.0.0.0        172.31.0.1      255.255.255.0   UG    0      0        0 eth0
10.0.2.0        172.31.0.3      255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
10.0.253.0      172.31.0.254    255.255.255.0   UG    0      0        0 eth0                # 非本宿主机上的eth0网卡，node02所在Node网络下相同Subnet下各node从Pod网络中所得subnet，相关路由

10.0.254.0      172.31.1.1      255.255.255.0   UG    0      0        0 tunl0
10.0.255.0      172.31.1.2      255.255.255.0   UG    0      0        0 tunl0
10.1.0.0        172.31.1.3      255.255.255.0   UG    0      0        0 tunl0
10.1.1.0        172.31.1.4      255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
10.1.251.0      172.31.1.254    255.255.255.0   UG    0      0        0 tunl0               # 非本宿主机上的tunl0网卡(隧道设备)，node02所在Node网络下不同Subnet下各node从Pod网络中所得subnet，相关路由

0.0.0.0         172.31.0.255    0.0.0.0         UG    0      0        0 eth0                # node02到所处Node网络下Subnet其网关的路由
172.31.0.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0                # node02到所处Node网络下Subnet其网关的路由
```

**Node网络下Subnet(172.31.1.0/24)下的节点(k8s node255)**
```
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.254.0      0.0.0.0         255.255.255.0   U     0      0        0 *
10.0.254.1      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>  
10.0.254.2      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
..........      0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>
10.0.254.255    0.0.0.0         255.255.255.255 UH    0      0        0 cali<随机数11位>    # 本机上其Pod副本的路由

10.0.0.0        172.31.0.1      255.255.255.0   UG    0      0        0 tunl0
10.0.1.0        172.31.0.2      255.255.255.0   UG    0      0        0 tunl0
10.0.2.0        172.31.0.3      255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
..........      ............    255.255.255.0   UG    0      0        0 tunl0
10.0.253.0      172.31.0.254    255.255.255.0   UG    0      0        0 tunl0               # 非本宿主机上的tunl0网卡(隧道设备)，node255所在Node网络下不同Subnet下各node从Pod网络中所得subnet，相关路由

10.0.255.0      172.31.1.2      255.255.255.0   UG    0      0        0 eth0
10.1.0.0        172.31.1.3      255.255.255.0   UG    0      0        0 eth0
10.1.1.0        172.31.1.4      255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
..........      ............    255.255.255.0   UG    0      0        0 eth0
10.1.251.0      172.31.1.254    255.255.255.0   UG    0      0        0 eth0                # 非本宿主机上的eth0网卡，node255所在Node网络下相同Subnet下各node从Pod网络中所得subnet，相关路由

0.0.0.0         172.31.1.255    0.0.0.0         UG    0      0        0 eth0                # node255到所处Node网络下Subnet其网关的路由
172.31.1.0      0.0.0.0         255.255.255.0   U     0      0        0 eth0                # node255到所处Node网络下Subnet其网关的路由
```

## 1.3 同宿主机上Pod间的通信
注意：直接通过本机的 Route Table进行路由后通信

## 1.4 跨宿主机(处于相同网关)间Pod的通信
注意：不会经过双方宿主机的隧道设备tunl0

## 1.5 跨宿主机(处于不同网关)间Pod的通信
注意：会经过双方宿主机的隧道设备tunl0




# 2.安装的相关步骤
