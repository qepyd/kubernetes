
======================================= 匿名请求 ============================================

# 1.生成token 
```
root@master01:~# echo "$(openssl rand -hex 3).$(openssl rand -hex 8)"
7ac43b.58266dbe587c6f5e
  # 
  # 第一部分为：令牌的ID，可由小写字母和数字组成，长度没有限制
  # 第二部分为：令牌的secret，可由小写字母和数字组成，长度没有限制
  #
```

# 2.curl工具访问kube-apiserver进行测试
```
## 命令
curl -H "Authorization: Bearer 7ac43b.58266dbe587c6f5e"  \
     --cacert /etc/kubernetes/pki/ca.crt                  \
     https://172.31.7.110:6443/api/v1/nodes

## 结果
{
  "kind": "Status",
  "apiVersion": "v1",
  "metadata": {},
  "status": "Failure",
  "message": "Unauthorized",
  "reason": "Unauthorized",
  "code": 401
}

## 结果说明
被kubernetes识别成了"匿名请求"，其过程为：
A：所推荐的token是非法的(kube-apiserver通过它无法得到用户标识)
B：那么用户标识将为：
   用户名：system:anonymous
   所属组：system:unauthenticated
C：其权限由kubernetes中的以下对象控制着:
   clusterrole/system:public-info-viewer
   clusterrolebinding/system:public-info-viewer 
D：注意：这里没有经过"准入控制"，因为我的操作命令是读(而读是会绕过"准入控制"的)。
```

# 3.kubectl工具相关参数指定值访问kube-apiserver进行测试
这里就不再制作kubeconfig文件后再结合测试，因为前面的client证书没有承载用户标识或用户标识和组标识。 这里直接用相关参数相关证书(k8s集群ca的证书、client所持k8s集群的ca证书,token、kube-apiserver的连接地址、操作命令)。
```
ls -l $HOME/.kube/config
mv $HOME/.kube/config  $HOME/.kube/config.bak
ls -l $HOME/.kube/config.bak

kubectl --server='https://172.31.7.110:6443'             \
   --certificate-authority=/etc/kubernetes/pki/ca.crt     \
   --token='7ac43b.58266dbe587c6f5e'                       \
   get nodes
   #
   # 结果为：error: You must be logged in to the server (Unauthorized)
   # 

mv $HOME/.kube/config.bak  $HOME/.kube/config
```
